Script started on Fri Oct 13 09:58:31 2017
u286120@imac-205[31]: cat 3-1.c
#include<stdio.h>
#include<stdlib.h>
#include<string.h>

#define DATANUM 54
#define FILENAME 50

unsigned char header[DATANUM];

void get_data(void);
//16進数変換 convert(header配列の添字4つ)
//4つ以下の場合はbmpの予約領域を割り当てること)
int convert(int a, int b, int c, int d);

int main(void){
  get_data();

  return 0;
}

void get_data(void){
  int c, i=0;
  int filesize, offset, width, height, bits;
  char fileName[FILENAME];
  FILE *fp;

  printf("入力ファイル名を入力して下さい:");
  scanf("%s", fileName);

  fp = fopen(fileName, "rb");
  if(fp == NULL){
    printf("ファイルをオープンできませんでした.\n");
    exit (1);
  }
  printf("ファイルをオープンしました.\n");

  c = fgetc(fp);
  while(i <= DATANUM){
    header[i] = c;
    c = fgetc(fp);
    i++;
  }

  printf("＜ファイルタイプ＞\n");
  printf("header[0]=%02X header[1]=%02X\n\n", header[0], header[1]);

  printf("＜ファイルサイズ＞\n");
  printf("header[2]=%02X header[3]=%02X header[4]=%02X header[5]=%02X\n",
	 header[2], header[3], header[4], header[5]);
  filesize = convert(2, 3, 4, 5);
  printf("%dバイト\n\n", filesize);

  printf("＜予約領域＞\n");
  printf("header[6]=%02X header[7]=%02X header[8]=%02X header[9]=%02X\n\n",
	 header[6], header[7], header[8], header[9]);

  printf("＜オフセット＞\n");
  printf("header[10]=%02X header[11]=%02X header[12]=%02X header[13]=%02X\n",
	 header[10], header[11], header[12], header[13]);
  offset = convert(10, 11, 12, 13);
  printf("%dバイト\n\n", offset);

  printf("＜情報ヘッダサイズ＞\n");
  printf("header[14]=%02X header[15]=%02X header[16]=%02X header[17]=%02X\n\n",
	 header[14], header[15], header[16], header[17]);

  printf("＜画像の幅＞\n");
  printf("header[18]=%02X header[19]=%02X header[20]=%02X header[21]=%02X\n",
	 header[18], header[19], header[20], header[21]);
  width = convert(18, 19, 20, 21);
  printf("%d画素\n\n", width);

  printf("＜画像の高さ＞\n");
  printf("header[22]=%02X header[23]=%02X header[24]=%02X header[25]=%02X\n",
	 header[22], header[23], header[24], header[25]);
  height = convert(22, 23, 24, 25);
  printf("%dライン\n\n", height);

  printf("＜色プレーン数＞\n");
  printf("header[26]=%02X header[27]=%02X\n\n", header[26], header[27]);

  printf("＜1画素当たりのビット数＞\n");
  printf("header[28]=%02X header[29]=%02X\n", header[28], header[29]);
  bits = convert(28, 29, 6, 6);
  printf("%dビット\n\n", bits);

  printf("＜圧縮方式＞\n");
  printf("header[30]=%02X header[31]=%02X header[32]=%02X header[33]=%02X\n\n",
	 header[30], header[31], header[32], header[33]);

  printf("＜画像データサイズ＞\n");
  printf("header[34]=%02X header[35]=%02X header[36]=%02X header[37]=%02X\n\n",
	 header[34], header[35], header[36], header[37]);

  printf("＜水平解像度＞\n");
  printf("header[38]=%02X header[39]=%02X header[40]=%02X header[41]=%02X\n\n",
	 header[38], header[39], header[40], header[41]);

  printf("＜垂直解像度＞\n");
  printf("header[42]=%02X header[43]=%02X header[44]=%02X header[45]=%02X\n\n",
	 header[42], header[43], header[44], header[45]);

  printf("＜色数＞\n");
  printf("header[46]=%02X header[47]=%02X header[48]=%02X header[49]=%02X\n\n",
	 header[38], header[39], header[40], header[41]);

  printf("＜重要な色数＞\n");
  printf("header[50]=%02X header[51]=%02X header[52]=%02X header[53]=%02X\n\n",
	  header[50], header[51], header[52], header[53]);

  printf("＜挿入ビット数＞\n");
  printf("%dバイト\n\n", filesize-offset-width*height*(bits/8));

  fclose(fp);
  printf("ファイルをクローズしました.\n");
}

int convert(int a, int b, int c, int d){
  char cSum[100];
  sprintf(cSum, "%02X%02X%02X%02X",
	 header[d], header[c], header[b], header[a] );
  return (int)strtol(cSum, NULL, 16);
}
u286120@imac-205[32]: gcc -Wall -o 301[K[K-1 -[K31[K-1.c
u286120@imac-205[33]: 3-1
入力ファイル名を入力して下さい:lenna.bmp
ファイルをオープンしました.
＜ファイルタイプ＞
header[0]=42 header[1]=4D

＜ファイルサイズ＞
header[2]=38 header[3]=00 header[4]=0C header[5]=00
786488バイト

＜予約領域＞
header[6]=00 header[7]=00 header[8]=00 header[9]=00

＜オフセット＞
header[10]=36 header[11]=00 header[12]=00 header[13]=00
54バイト

＜情報ヘッダサイズ＞
header[14]=28 header[15]=00 header[16]=00 header[17]=00

＜画像の幅＞
header[18]=00 header[19]=02 header[20]=00 header[21]=00
512画素

＜画像の高さ＞
header[22]=00 header[23]=02 header[24]=00 header[25]=00
512ライン

＜色プレーン数＞
header[26]=01 header[27]=00

＜1画素当たりのビット数＞
header[28]=18 header[29]=00
24ビット

＜圧縮方式＞
header[30]=00 header[31]=00 header[32]=00 header[33]=00

＜画像データサイズ＞
header[34]=00 header[35]=00 header[36]=00 header[37]=00

＜水平解像度＞
header[38]=12 header[39]=0B header[40]=00 header[41]=00

＜垂直解像度＞
header[42]=12 header[43]=0B header[44]=00 header[45]=00

＜色数＞
header[46]=12 header[47]=0B header[48]=00 header[49]=00

＜重要な色数＞
header[50]=00 header[51]=00 header[52]=00 header[53]=00

＜挿入ビット数＞
2バイト

ファイルをクローズしました.
u286120@imac-205[34]: exit
exit

Script done on Fri Oct 13 09:59:01 2017
